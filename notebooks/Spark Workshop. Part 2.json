{"paragraphs":[{"text":"import org.apache.spark._\nimport org.apache.spark.sql._\n\nimport spark.implicits._","user":"anonymous","dateUpdated":"2018-03-09T09:33:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark._\nimport org.apache.spark.sql._\nimport spark.implicits._\n"}]},"apps":[],"jobName":"paragraph_1520587994206_-1030874169","id":"20180308-093724_2141785589","dateCreated":"2018-03-09T09:33:14+0000","dateStarted":"2018-03-09T09:33:22+0000","dateFinished":"2018-03-09T09:33:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3440"},{"text":"val ds = spark.read.parquet(\"s3://workshop-lviv/data/ds1/\")","user":"anonymous","dateUpdated":"2018-03-09T09:33:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"ds: org.apache.spark.sql.DataFrame = [uri: string, content: string]\n"}]},"apps":[],"jobName":"paragraph_1520587994206_-1030874169","id":"20180308-101433_184148360","dateCreated":"2018-03-09T09:33:14+0000","dateStarted":"2018-03-09T09:33:26+0000","dateFinished":"2018-03-09T09:33:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3441"},{"text":"import com.johnsnowlabs.nlp._\nimport com.johnsnowlabs.nlp.annotators._\nimport com.johnsnowlabs.nlp.annotators.sbd.pragmatic.SentenceDetector\nimport com.johnsnowlabs.nlp.annotators.pos.perceptron.PerceptronApproach\nimport org.apache.spark.ml.Pipeline\n\nval documentAssembler = new DocumentAssembler().setInputCol(\"content\").setOutputCol(\"document\")\n\nval sentenceDetector = new SentenceDetector()\n    .setInputCols(Array(\"document\"))\n    .setOutputCol(\"sentence\")\n\nval regexTokenizer = new Tokenizer()\n    .setInputCols(Array(\"sentence\"))\n    .setOutputCol(\"token\")\n    \nval posTagger = new PerceptronApproach()\n  .setInputCols(Array(\"sentence\", \"token\"))\n  .setOutputCol(\"pos\")\n  \nval finisher = new Finisher()\n    .setInputCols(\"token\")\n    .setCleanAnnotations(false)\n\nval pipeline = new Pipeline()\n    .setStages(Array(\n        documentAssembler,\n        sentenceDetector,\n        regexTokenizer,\n        posTagger,\n        finisher\n    ))\n\nval res= \n  pipeline\n    .fit(ds)\n    .transform(ds)\n","user":"anonymous","dateUpdated":"2018-03-09T09:33:40+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import com.johnsnowlabs.nlp._\nimport com.johnsnowlabs.nlp.annotators._\nimport com.johnsnowlabs.nlp.annotators.sbd.pragmatic.SentenceDetector\nimport com.johnsnowlabs.nlp.annotators.pos.perceptron.PerceptronApproach\nimport org.apache.spark.ml.Pipeline\ndocumentAssembler: com.johnsnowlabs.nlp.DocumentAssembler = document_8936b4e3df73\nsentenceDetector: com.johnsnowlabs.nlp.annotators.sbd.pragmatic.SentenceDetector = SENTENCE_68e11055e472\nregexTokenizer: com.johnsnowlabs.nlp.annotators.Tokenizer = REGEX_TOKENIZER_dfa3fb1849d6\nposTagger: com.johnsnowlabs.nlp.annotators.pos.perceptron.PerceptronApproach = POS_645bf5e30506\nfinisher: com.johnsnowlabs.nlp.Finisher = document_ac1689133c0a\npipeline: org.apache.spark.ml.Pipeline = pipeline_42e972278de6\nres: org.apache.spark.sql.DataFrame = [uri: string, content: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1520587994207_-1031258918","id":"20180308-101640_611860144","dateCreated":"2018-03-09T09:33:14+0000","dateStarted":"2018-03-09T09:33:40+0000","dateFinished":"2018-03-09T09:39:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3442"},{"text":"res.schema","dateUpdated":"2018-03-09T09:33:14+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res38: org.apache.spark.sql.types.StructType = StructType(StructField(uri,StringType,true), StructField(content,StringType,true), StructField(document,ArrayType(StructType(StructField(annotatorType,StringType,true), StructField(start,IntegerType,false), StructField(end,IntegerType,false), StructField(result,StringType,true), StructField(metadata,MapType(StringType,StringType,true),true)),true),true), StructField(sentence,ArrayType(StructType(StructField(annotatorType,StringType,true), StructField(start,IntegerType,false), StructField(end,IntegerType,false), StructField(result,StringType,true), StructField(metadata,MapType(StringType,StringType,true),true)),true),true), StructField(token,ArrayType(StructType(StructField(annotatorType,StringType,true), StructField(start,IntegerType,false)..."}]},"apps":[],"jobName":"paragraph_1520587994207_-1031258918","id":"20180308-103400_737734610","dateCreated":"2018-03-09T09:33:14+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3443"},{"text":"case class Annotation(annotatorType: String, start: Int, end: Int, result: String, metadata: Map[String, String])","user":"anonymous","dateUpdated":"2018-03-09T09:42:05+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class Annotation\n"}]},"apps":[],"jobName":"paragraph_1520587994207_-1031258918","id":"20180308-101840_1918165220","dateCreated":"2018-03-09T09:33:14+0000","dateStarted":"2018-03-09T09:42:05+0000","dateFinished":"2018-03-09T09:42:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3444"},{"text":"case class AnnotatedRecord(uri: String, content: String, document: Array[Annotation], sentence: Array[Annotation], pos: Array[Annotation])","user":"anonymous","dateUpdated":"2018-03-09T09:42:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class AnnotatedRecord\n"}]},"apps":[],"jobName":"paragraph_1520587994207_-1031258918","id":"20180308-103533_1967677077","dateCreated":"2018-03-09T09:33:14+0000","dateStarted":"2018-03-09T09:42:22+0000","dateFinished":"2018-03-09T09:42:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3445"},{"text":"res.as[AnnotatedRecord].flatMap(p => p.pos).show(10)","user":"anonymous","dateUpdated":"2018-03-09T09:42:33+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+-----+---+------+--------------------+\n|annotatorType|start|end|result|            metadata|\n+-------------+-----+---+------+--------------------+\n|          pos|    0|  5|   NNP| Map(word -> Nissan)|\n|          pos|    7|  9|   NNP|    Map(word -> Key)|\n|          pos|   11| 17|   NNP|Map(word -> Service)|\n|          pos|   19| 26|  NNPS|Map(word -> Servi...|\n|          pos|   28| 29|    IN|     Map(word -> at)|\n|          pos|   31| 39|   NNP|Map(word -> Minne...|\n|          pos|   41| 42|   NNP|     Map(word -> MN)|\n|          pos|   44| 44|     :|      Map(word -> -)|\n|          pos|   46| 48|   NNP|    Map(word -> Low)|\n|          pos|   50| 54|   NNP|  Map(word -> Rates)|\n+-------------+-----+---+------+--------------------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1520587994207_-1031258918","id":"20180308-104358_980770305","dateCreated":"2018-03-09T09:33:14+0000","dateStarted":"2018-03-09T09:42:33+0000","dateFinished":"2018-03-09T09:42:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3446"},{"text":"case class TokenRow(uri: String, token: String, posTag: String, tokenStart: Int, tokenEnd: Int, tokenPos: Int, sentenceStart: Int, sentenceEnd: Int, sentencePos: Int, docLength: Int)","user":"anonymous","dateUpdated":"2018-03-09T10:42:11+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class TokenRow\n"}]},"apps":[],"jobName":"paragraph_1520588274693_-11675978","id":"20180309-093754_512293306","dateCreated":"2018-03-09T09:37:54+0000","dateStarted":"2018-03-09T10:42:11+0000","dateFinished":"2018-03-09T10:42:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3447"},{"text":"(\"a\" :: \"b\" :: Nil).zipWithIndex","user":"anonymous","dateUpdated":"2018-03-09T10:20:34+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res54: List[(String, Int)] = List((a,0), (b,1))\n"}]},"apps":[],"jobName":"paragraph_1520590806118_-1623786501","id":"20180309-102006_1458658972","dateCreated":"2018-03-09T10:20:06+0000","dateStarted":"2018-03-09T10:20:34+0000","dateFinished":"2018-03-09T10:20:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3448"},{"text":"val tokens =\n  res\n  .as[AnnotatedRecord]\n  .flatMap { ar =>\n    val docLength = ar.document.head.end\n    val sentences = ar.sentence.zipWithIndex.map { case (sa, ind) =>\n        (sa.start, sa.end, ind)\n    }\n    \n    ar.pos.zipWithIndex.map { case (pa, ind) =>\n        val (sentStart, sentEnd, sentPos) = sentences.collectFirst {\n            case  sent@(s, e, i) if pa.start >= s && pa.end <= e => sent\n        } getOrElse (-1, -1, -1)\n        \n        TokenRow(\n            uri = ar.uri,\n            token = pa.metadata(\"word\"),\n            posTag = pa.result,\n            tokenStart = pa.start, \n            tokenEnd = pa.end,\n            tokenPos = ind, \n            sentenceStart = sentStart,\n            sentenceEnd = sentEnd,\n            sentencePos = sentPos,\n            docLength = docLength\n        )\n    }\n}","user":"anonymous","dateUpdated":"2018-03-09T10:51:17+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"tokens: org.apache.spark.sql.Dataset[TokenRow] = [uri: string, token: string ... 8 more fields]\n"}]},"apps":[],"jobName":"paragraph_1520588679781_-1605353015","id":"20180309-094439_747699110","dateCreated":"2018-03-09T09:44:39+0000","dateStarted":"2018-03-09T10:51:17+0000","dateFinished":"2018-03-09T10:51:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3449"},{"text":"tokens.show(10)","user":"anonymous","dateUpdated":"2018-03-09T10:51:34+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+---------+------+----------+--------+--------+-------------+-----------+-----------+---------+\n|                 uri|    token|posTag|tokenStart|tokenEnd|tokenPos|sentenceStart|sentenceEnd|sentencePos|docLength|\n+--------------------+---------+------+----------+--------+--------+-------------+-----------+-----------+---------+\n|http://24mn--minn...|   Nissan|   NNP|         0|       5|       0|            0|        639|          0|    12748|\n|http://24mn--minn...|      Key|   NNP|         7|       9|       1|            0|        639|          0|    12748|\n|http://24mn--minn...|  Service|   NNP|        11|      17|       2|            0|        639|          0|    12748|\n|http://24mn--minn...| Services|  NNPS|        19|      26|       3|            0|        639|          0|    12748|\n|http://24mn--minn...|       at|    IN|        28|      29|       4|            0|        639|          0|    12748|\n|http://24mn--minn...|Minnesota|   NNP|        31|      39|       5|            0|        639|          0|    12748|\n|http://24mn--minn...|       MN|   NNP|        41|      42|       6|            0|        639|          0|    12748|\n|http://24mn--minn...|        -|     :|        44|      44|       7|            0|        639|          0|    12748|\n|http://24mn--minn...|      Low|   NNP|        46|      48|       8|            0|        639|          0|    12748|\n|http://24mn--minn...|    Rates|   NNP|        50|      54|       9|            0|        639|          0|    12748|\n+--------------------+---------+------+----------+--------+--------+-------------+-----------+-----------+---------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1520592684635_-61977990","id":"20180309-105124_1676946328","dateCreated":"2018-03-09T10:51:24+0000","dateStarted":"2018-03-09T10:51:34+0000","dateFinished":"2018-03-09T10:51:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3450"},{"text":"tokens\n  .limit(100000)\n  .coalesce(10)\n  .write\n  .mode(SaveMode.Overwrite)\n  .parquet(\"s3://workshop-lviv/data/ds2/\")","user":"anonymous","dateUpdated":"2018-03-09T13:18:47+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1520587994208_-1045494628","id":"20180308-104423_1081336875","dateCreated":"2018-03-09T09:33:14+0000","dateStarted":"2018-03-09T13:18:47+0000","dateFinished":"2018-03-09T13:19:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3451"},{"dateUpdated":"2018-03-09T09:33:14+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520587994208_-1045494628","id":"20180308-163106_893378609","dateCreated":"2018-03-09T09:33:14+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3452"}],"name":"Spark Workshop. Part 2","id":"2D8KX1PTD","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}