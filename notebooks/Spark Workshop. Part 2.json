{"paragraphs":[{"text":"import org.apache.spark._\nimport org.apache.spark.sql._\n\nimport spark.implicits._","user":"anonymous","dateUpdated":"2018-03-10T09:39:36+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark._\nimport org.apache.spark.sql._\nimport spark.implicits._\n"}]},"apps":[],"jobName":"paragraph_1520670198118_7955044","id":"20180308-093724_2141785589","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T09:39:36+0000","dateFinished":"2018-03-10T09:39:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1368"},{"text":"val ds = spark.read.parquet(\"s3://workshop-lviv/data/ds1/\")","user":"anonymous","dateUpdated":"2018-03-10T09:39:41+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"ds: org.apache.spark.sql.DataFrame = [uri: string, domain: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1520670198118_7955044","id":"20180308-101433_184148360","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T09:39:41+0000","dateFinished":"2018-03-10T09:39:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1369"},{"text":"import com.johnsnowlabs.nlp._\nimport com.johnsnowlabs.nlp.annotators._\nimport com.johnsnowlabs.nlp.annotators.sbd.pragmatic.SentenceDetector\nimport com.johnsnowlabs.nlp.annotators.pos.perceptron.PerceptronApproach\nimport org.apache.spark.ml.Pipeline\n\nval documentAssembler = new DocumentAssembler().setInputCol(\"content\").setOutputCol(\"document\")\n\nval sentenceDetector = new SentenceDetector()\n    .setInputCols(Array(\"document\"))\n    .setOutputCol(\"sentence\")\n\nval regexTokenizer = new Tokenizer()\n    .setInputCols(Array(\"sentence\"))\n    .setOutputCol(\"token\")\n    \nval posTagger = new PerceptronApproach()\n  .setInputCols(Array(\"sentence\", \"token\"))\n  .setOutputCol(\"pos\")\n  \nval finisher = new Finisher()\n    .setInputCols(\"token\")\n    .setCleanAnnotations(false)\n\nval pipeline = new Pipeline()\n    .setStages(Array(\n        documentAssembler,\n        sentenceDetector,\n        regexTokenizer,\n        posTagger,\n        finisher\n    ))","user":"anonymous","dateUpdated":"2018-03-10T09:47:00+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import com.johnsnowlabs.nlp._\nimport com.johnsnowlabs.nlp.annotators._\nimport com.johnsnowlabs.nlp.annotators.sbd.pragmatic.SentenceDetector\nimport com.johnsnowlabs.nlp.annotators.pos.perceptron.PerceptronApproach\nimport org.apache.spark.ml.Pipeline\ndocumentAssembler: com.johnsnowlabs.nlp.DocumentAssembler = document_61fef1ca0d81\nsentenceDetector: com.johnsnowlabs.nlp.annotators.sbd.pragmatic.SentenceDetector = SENTENCE_a0a552cdb0b8\nregexTokenizer: com.johnsnowlabs.nlp.annotators.Tokenizer = REGEX_TOKENIZER_329807248bb6\nposTagger: com.johnsnowlabs.nlp.annotators.pos.perceptron.PerceptronApproach = POS_e3b8bf764db6\nfinisher: com.johnsnowlabs.nlp.Finisher = document_2d385845b368\npipeline: org.apache.spark.ml.Pipeline = pipeline_50d899beaf0a\nres: org.apache.spark.sql.DataFrame = [uri: string, domain: string ... 6 more fields]\n"}]},"apps":[],"jobName":"paragraph_1520670198118_7955044","id":"20180308-101640_611860144","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T09:39:50+0000","dateFinished":"2018-03-10T09:45:22+0000","status":"ABORT","progressUpdateIntervalMs":500,"$$hashKey":"object:1370"},{"text":"val model = \n  pipeline\n    .fit(ds)\n    ","user":"anonymous","dateUpdated":"2018-03-10T09:45:29+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"model: org.apache.spark.ml.PipelineModel = pipeline_50d899beaf0a\n"}]},"apps":[],"jobName":"paragraph_1520675028053_-2132306806","id":"20180310-094348_216921714","dateCreated":"2018-03-10T09:43:48+0000","dateStarted":"2018-03-10T09:45:29+0000","dateFinished":"2018-03-10T09:50:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1371"},{"text":"model.save(\"s3://workshop-lviv/model/pos/\")\nval res = model.transform(ds)","user":"anonymous","dateUpdated":"2018-03-10T09:54:32+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res: org.apache.spark.sql.DataFrame = [uri: string, domain: string ... 6 more fields]\n"}]},"apps":[],"jobName":"paragraph_1520675032741_1588245707","id":"20180310-094352_1875612647","dateCreated":"2018-03-10T09:43:52+0000","dateStarted":"2018-03-10T09:54:32+0000","dateFinished":"2018-03-10T09:54:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1372"},{"text":"res.schema","user":"anonymous","dateUpdated":"2018-03-10T10:05:55+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res54: org.apache.spark.sql.types.StructType = StructType(StructField(uri,StringType,true), StructField(domain,StringType,true), StructField(content,StringType,true), StructField(document,ArrayType(StructType(StructField(annotatorType,StringType,true), StructField(start,IntegerType,false), StructField(end,IntegerType,false), StructField(result,StringType,true), StructField(metadata,MapType(StringType,StringType,true),true)),true),true), StructField(sentence,ArrayType(StructType(StructField(annotatorType,StringType,true), StructField(start,IntegerType,false), StructField(end,IntegerType,false), StructField(result,StringType,true), StructField(metadata,MapType(StringType,StringType,true),true)),true),true), StructField(token,ArrayType(StructType(StructField(annotatorType,StringType,true),..."}]},"apps":[],"jobName":"paragraph_1520670198118_7955044","id":"20180308-103400_737734610","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T10:05:55+0000","dateFinished":"2018-03-10T10:05:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1373"},{"text":"case class Annotation(annotatorType: String, start: Int, end: Int, result: String, metadata: Map[String, String])","user":"anonymous","dateUpdated":"2018-03-10T10:06:11+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class Annotation\n"}]},"apps":[],"jobName":"paragraph_1520670198118_7955044","id":"20180308-101840_1918165220","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T10:06:11+0000","dateFinished":"2018-03-10T10:06:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1374"},{"text":"case class AnnotatedRecord(uri: String, domain: String, content: String, document: Array[Annotation], sentence: Array[Annotation], pos: Array[Annotation])","user":"anonymous","dateUpdated":"2018-03-10T10:06:13+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class AnnotatedRecord\n"}]},"apps":[],"jobName":"paragraph_1520670198118_7955044","id":"20180308-103533_1967677077","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T10:06:13+0000","dateFinished":"2018-03-10T10:06:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1375"},{"text":"res.as[AnnotatedRecord].flatMap(p => p.pos).show(10)","user":"anonymous","dateUpdated":"2018-03-10T10:06:18+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+-----+---+------+--------------------+\n|annotatorType|start|end|result|            metadata|\n+-------------+-----+---+------+--------------------+\n|          pos|    0|  6|    NN|Map(word -> Message)|\n|          pos|    8| 12|   NNP|  Map(word -> Bored)|\n|          pos|   14| 14|    NN|      Map(word -> •)|\n|          pos|   16| 19|   NNP|   Map(word -> View)|\n|          pos|   21| 25|    NN|  Map(word -> topic)|\n|          pos|   27| 27|     :|      Map(word -> -)|\n|          pos|   29| 31|   PRP|    Map(word -> You)|\n|          pos|   33| 36|   VBP|   Map(word -> know)|\n|          pos|   38| 41|    WP|   Map(word -> what)|\n|          pos|   43| 46|    NN|   Map(word -> band)|\n+-------------+-----+---+------+--------------------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1520670198118_7955044","id":"20180308-104358_980770305","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T10:06:18+0000","dateFinished":"2018-03-10T10:06:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1376"},{"text":"case class TokenRow(uri: String, domain: String, token: String, posTag: String, tokenStart: Int, tokenEnd: Int, tokenPos: Int, sentenceStart: Int, sentenceEnd: Int, sentencePos: Int, docLength: Int)","user":"anonymous","dateUpdated":"2018-03-10T10:08:51+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class TokenRow\n"}]},"apps":[],"jobName":"paragraph_1520670198118_7955044","id":"20180309-093754_512293306","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T10:08:51+0000","dateFinished":"2018-03-10T10:08:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1377"},{"text":"(\"a\" :: \"b\" :: Nil).zipWithIndex","user":"anonymous","dateUpdated":"2018-03-10T10:08:52+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res57: List[(String, Int)] = List((a,0), (b,1))\n"}]},"apps":[],"jobName":"paragraph_1520670198119_7570296","id":"20180309-102006_1458658972","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T10:08:52+0000","dateFinished":"2018-03-10T10:08:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1378"},{"text":"val tokens =\n  res\n  .as[AnnotatedRecord]\n  .flatMap { ar =>\n    val docLength = ar.document.head.end\n    val sentences = ar.sentence.zipWithIndex.map { case (sa, ind) =>\n        (sa.start, sa.end, ind)\n    }\n    \n    ar.pos.zipWithIndex.map { case (pa, ind) =>\n        val (sentStart, sentEnd, sentPos) = sentences.collectFirst {\n            case  sent@(s, e, i) if pa.start >= s && pa.end <= e => sent\n        } getOrElse (-1, -1, -1)\n        \n        TokenRow(\n            uri = ar.uri,\n            domain = ar.domain,\n            token = pa.metadata(\"word\"),\n            posTag = pa.result,\n            tokenStart = pa.start, \n            tokenEnd = pa.end,\n            tokenPos = ind, \n            sentenceStart = sentStart,\n            sentenceEnd = sentEnd,\n            sentencePos = sentPos,\n            docLength = docLength\n        )\n    }\n}","user":"anonymous","dateUpdated":"2018-03-10T10:08:54+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"tokens: org.apache.spark.sql.Dataset[TokenRow] = [uri: string, domain: string ... 9 more fields]\n"}]},"apps":[],"jobName":"paragraph_1520670198119_7570296","id":"20180309-094439_747699110","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T10:08:54+0000","dateFinished":"2018-03-10T10:08:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1379"},{"text":"tokens.show(10)","user":"anonymous","dateUpdated":"2018-03-10T10:09:02+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+------------+-------+------+----------+--------+--------+-------------+-----------+-----------+---------+\n|                 uri|      domain|  token|posTag|tokenStart|tokenEnd|tokenPos|sentenceStart|sentenceEnd|sentencePos|docLength|\n+--------------------+------------+-------+------+----------+--------+--------+-------------+-----------+-----------+---------+\n|http://adamrulz.c...|adamrulz.com|Message|    NN|         0|       6|       0|            0|         53|          0|     6263|\n|http://adamrulz.c...|adamrulz.com|  Bored|   NNP|         8|      12|       1|            0|         53|          0|     6263|\n|http://adamrulz.c...|adamrulz.com|      •|    NN|        14|      14|       2|            0|         53|          0|     6263|\n|http://adamrulz.c...|adamrulz.com|   View|   NNP|        16|      19|       3|            0|         53|          0|     6263|\n|http://adamrulz.c...|adamrulz.com|  topic|    NN|        21|      25|       4|            0|         53|          0|     6263|\n|http://adamrulz.c...|adamrulz.com|      -|     :|        27|      27|       5|            0|         53|          0|     6263|\n|http://adamrulz.c...|adamrulz.com|    You|   PRP|        29|      31|       6|            0|         53|          0|     6263|\n|http://adamrulz.c...|adamrulz.com|   know|   VBP|        33|      36|       7|            0|         53|          0|     6263|\n|http://adamrulz.c...|adamrulz.com|   what|    WP|        38|      41|       8|            0|         53|          0|     6263|\n|http://adamrulz.c...|adamrulz.com|   band|    NN|        43|      46|       9|            0|         53|          0|     6263|\n+--------------------+------------+-------+------+----------+--------+--------+-------------+-----------+-----------+---------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1520670198119_7570296","id":"20180309-105124_1676946328","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T10:09:02+0000","dateFinished":"2018-03-10T10:09:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1380"},{"text":"tokens.where($\"sentencePos\" === 2).show(20)","user":"anonymous","dateUpdated":"2018-03-10T10:36:13+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+------------+----------+------+----------+--------+--------+-------------+-----------+-----------+---------+\n|                 uri|      domain|     token|posTag|tokenStart|tokenEnd|tokenPos|sentenceStart|sentenceEnd|sentencePos|docLength|\n+--------------------+------------+----------+------+----------+--------+--------+-------------+-----------+-----------+---------+\n|http://adamrulz.c...|adamrulz.com|        It|   PRP|       106|     107|      21|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|        is|   VBZ|       109|     110|      22|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com| currently|    RB|       112|     120|      23|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|       Sat|   NNP|       122|     124|      24|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|       Feb|   NNP|       126|     128|      25|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|        17|    CD|       130|     131|      26|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|         ,|     ,|       132|     132|      27|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|      2018|    CD|       134|     137|      28|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|      2:25|    NN|       139|     142|      29|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|        pm|    NN|       144|     145|      30|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|      View|   NNP|       147|     150|      31|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|unanswered|   VBD|       152|     161|      32|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|     posts|   NNS|       163|     167|      33|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|         ||   NNP|       169|     169|      34|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|      View|   NNP|       171|     174|      35|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|    active|    JJ|       176|     181|      36|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|    topics|   NNS|       183|     188|      37|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|     Board|   NNP|       190|     194|      38|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|     index|    NN|       196|     200|      39|          106|        295|          2|     6263|\n|http://adamrulz.c...|adamrulz.com|         »|    NN|       202|     202|      40|          106|        295|          2|     6263|\n+--------------------+------------+----------+------+----------+--------+--------+-------------+-----------+-----------+---------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1520677985328_978195939","id":"20180310-103305_923150897","dateCreated":"2018-03-10T10:33:05+0000","dateStarted":"2018-03-10T10:36:13+0000","dateFinished":"2018-03-10T10:36:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1381"},{"text":"tokens\n  .limit(100000)\n  .coalesce(10)\n  .write\n  .mode(SaveMode.Overwrite)\n  .parquet(\"s3://workshop-lviv/data/ds2/\")","user":"anonymous","dateUpdated":"2018-03-10T10:31:37+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1520670198119_7570296","id":"20180308-104423_1081336875","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T10:31:37+0000","dateFinished":"2018-03-10T10:33:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1382"},{"text":"tokens\n  .limit(1000000)\n  .coalesce(20)\n  .write\n  .mode(SaveMode.Overwrite)\n  .parquet(\"s3://workshop-lviv/data/ds3/\")","user":"anonymous","dateUpdated":"2018-03-10T12:59:39+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1520670198119_7570296","id":"20180308-163106_893378609","dateCreated":"2018-03-10T08:23:18+0000","dateStarted":"2018-03-10T12:59:40+0000","dateFinished":"2018-03-10T13:09:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1383"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520677627142_2069871420","id":"20180310-102707_1740206684","dateCreated":"2018-03-10T10:27:07+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1384"}],"name":"Spark Workshop. Part 2","id":"2D9QKP42F","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}