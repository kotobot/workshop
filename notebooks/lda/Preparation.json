{"paragraphs":[{"text":"import org.apache.spark._\nimport org.apache.spark.sql._\n\nimport spark.implicits._","user":"anonymous","dateUpdated":"2018-05-15T09:21:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark._\nimport org.apache.spark.sql._\nimport spark.implicits._\n"}]},"apps":[],"jobName":"paragraph_1526376056944_1482763058","id":"20180302-150043_1447342835","dateCreated":"2018-05-15T09:20:56+0000","dateStarted":"2018-05-15T09:21:03+0000","dateFinished":"2018-05-15T09:21:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:12722"},{"text":"val prefix = \"s3://commoncrawl/\"\nval wetPaths = spark.read.textFile(\"s3://commoncrawl/crawl-data/CC-MAIN-2018-09/wet.paths.gz\").take(20).map(prefix + _)","user":"anonymous","dateUpdated":"2018-05-15T09:21:58+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"prefix: String = s3://commoncrawl/\nwetPaths: Array[String] = Array(s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-20180217205905-00000.warc.wet.gz, s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-20180217205905-00001.warc.wet.gz, s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-20180217205905-00002.warc.wet.gz, s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-20180217205905-00003.warc.wet.gz, s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-20180217205905-00004.warc.wet.gz, s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-2018021720590..."}]},"apps":[],"jobName":"paragraph_1526376056947_1483147807","id":"20180306-095333_1759895334","dateCreated":"2018-05-15T09:20:56+0000","dateStarted":"2018-05-15T09:21:58+0000","dateFinished":"2018-05-15T09:22:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12723"},{"text":"import com.martinkl.warc._\nimport com.martinkl.warc.mapreduce._\nimport org.apache.hadoop.io._\n\nval wetsRDD = sc.newAPIHadoopFile[LongWritable, WARCWritable, WARCInputFormat](wetPaths.mkString(\",\"))","user":"anonymous","dateUpdated":"2018-05-15T09:22:02+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import com.martinkl.warc._\nimport com.martinkl.warc.mapreduce._\nimport org.apache.hadoop.io._\nwetsRDD: org.apache.spark.rdd.RDD[(org.apache.hadoop.io.LongWritable, com.martinkl.warc.WARCWritable)] = s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-20180217205905-00000.warc.wet.gz,s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-20180217205905-00001.warc.wet.gz,s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-20180217205905-00002.warc.wet.gz,s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-20180217205905-00003.warc.wet.gz,s3://commoncrawl/crawl-data/CC-MAIN-2018-09/segments/1518891807660.32/wet/CC-MAIN-20180217185905-20180217205905-00004.warc.wet.gz,s3://commoncrawl/crawl-data/CC-MAIN-2018-0..."}]},"apps":[],"jobName":"paragraph_1526376056947_1483147807","id":"20180306-100910_1548847375","dateCreated":"2018-05-15T09:20:56+0000","dateStarted":"2018-05-15T09:22:02+0000","dateFinished":"2018-05-15T09:22:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12724"},{"text":"wetsRDD.count()","user":"anonymous","dateUpdated":"2018-05-15T09:22:15+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res2: Long = 852021\n"}]},"apps":[],"jobName":"paragraph_1526376056948_1481224062","id":"20180309-083211_156199231","dateCreated":"2018-05-15T09:20:56+0000","dateStarted":"2018-05-15T09:22:15+0000","dateFinished":"2018-05-15T09:22:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12725"},{"text":"case class Record(uri: String, domain: String,  content: String)","user":"anonymous","dateUpdated":"2018-05-15T09:22:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class Record\n"}]},"apps":[],"jobName":"paragraph_1526376056948_1481224062","id":"20180309-054550_1574744604","dateCreated":"2018-05-15T09:20:56+0000","dateStarted":"2018-05-15T09:22:24+0000","dateFinished":"2018-05-15T09:22:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12726"},{"text":"import com.optimaize.langdetect.LanguageDetectorBuilder\nimport com.optimaize.langdetect.ngram.NgramExtractors\nimport com.optimaize.langdetect.profiles.LanguageProfileReader\nimport com.optimaize.langdetect.text.CommonTextObjectFactories\nimport scala.util._\nimport java.net.URL\n\nval MinContentLength = 1000\n\nval recordsDS1 = wetsRDD\n .repartition(100)\n .mapPartitions { it =>\n    val languageProfiles = new LanguageProfileReader().readAllBuiltIn()\n    val languageDetector = LanguageDetectorBuilder.create(NgramExtractors.standard).withProfiles(languageProfiles).build\n    val textObjectFactory = CommonTextObjectFactories.forDetectingOnLargeText\n    \n    def isEnglish(text: String) = {\n        val textObject = textObjectFactory.forText(text)\n        val ps = languageDetector.getProbabilities(textObject)\n        !ps.isEmpty && ps.get(0).getProbability > 0.9 && ps.get(0).getLocale.getLanguage == \"en\"\n    }\n    \n    it.flatMap { case (_, r) =>\n       val content = new String(r.getRecord().getContent(), \"UTF-8\") \n       val uri = r.getRecord().getHeader().getTargetURI()\n       if (content.length >= MinContentLength && isEnglish(content)) {\n            Try {\n              val url = new URL(uri)\n              Record(uri, url.getHost, content)\n            }.toOption\n       } else {\n           None\n       }\n    }\n }\n .toDS()","user":"anonymous","dateUpdated":"2018-05-15T09:23:59+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import com.optimaize.langdetect.LanguageDetectorBuilder\nimport com.optimaize.langdetect.ngram.NgramExtractors\nimport com.optimaize.langdetect.profiles.LanguageProfileReader\nimport com.optimaize.langdetect.text.CommonTextObjectFactories\nimport scala.util._\nimport java.net.URL\nMinContentLength: Int = 1000\nrecordsDS1: org.apache.spark.sql.Dataset[Record] = [uri: string, domain: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1526376056949_1480839313","id":"20180309-053451_1573508842","dateCreated":"2018-05-15T09:20:56+0000","dateStarted":"2018-05-15T09:23:59+0000","dateFinished":"2018-05-15T09:24:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12727"},{"text":"recordsDS1.count()","user":"anonymous","dateUpdated":"2018-05-15T09:24:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res9: Long = 357897\n"}]},"apps":[],"jobName":"paragraph_1526376056949_1480839313","id":"20180309-060614_189789641","dateCreated":"2018-05-15T09:20:56+0000","dateStarted":"2018-05-15T09:24:19+0000","dateFinished":"2018-05-15T09:33:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12728"},{"text":"recordsDS1\n  .coalesce(20)\n  .write\n  .mode(SaveMode.Overwrite)\n  .parquet(\"s3://cc-processing/data/ds1/\")","user":"anonymous","dateUpdated":"2018-05-15T09:30:31+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526376056949_1480839313","id":"20180309-054904_1297758949","dateCreated":"2018-05-15T09:20:56+0000","dateStarted":"2018-05-15T09:30:31+0000","dateFinished":"2018-05-15T09:45:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12729"},{"text":"val test = spark.read.parquet(\"s3://cc-processing/data/ds1/\")\ntest.show(10)","user":"anonymous","dateUpdated":"2018-05-15T09:47:50+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{"1":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"test: org.apache.spark.sql.DataFrame = [uri: string, domain: string ... 1 more field]\n+--------------------+--------------------+--------------------+\n|                 uri|              domain|             content|\n+--------------------+--------------------+--------------------+\n|http://42itus.blo...| 42itus.blogspot.com|Northern Perspect...|\n|http://acharyadas...|      acharyadas.com|understanding Dea...|\n|http://aistcraft....|       aistcraft.com|jewelry box\nCurre...|\n|http://aliashire....|     aliashire.co.uk|sony - Alias Hire...|\n|http://alohababym...|alohababymoore.bl...|ALOHA BABY MOORE:...|\n|http://annarbormo...|annarbormom.blogs...|Ann Arbor Mom Blo...|\n|http://apmamerica...|      apmamerica.com|Lesbians in stock...|\n|http://asingularc...|asingularcreation...|Art Forums - A Si...|\n|http://beach-home...|beach-homevacatio...|Things CEOs shoul...|\n|http://bitcoinist...|      bitcoinist.com|99Bitcoins Has Pa...|\n+--------------------+--------------------+--------------------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1526376056950_1481993560","id":"20180307-155144_880378056","dateCreated":"2018-05-15T09:20:56+0000","dateStarted":"2018-05-15T09:47:50+0000","dateFinished":"2018-05-15T09:47:54+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12730"},{"text":"val sampleDS = test\n  .sample(true, 0.1)\n  .repartition(1000)\n  .cache()","user":"anonymous","dateUpdated":"2018-05-15T11:45:18+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sampleDS: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [uri: string, domain: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1526376056950_1481993560","id":"20180308-161233_1986251360","dateCreated":"2018-05-15T09:20:56+0000","dateStarted":"2018-05-15T11:45:18+0000","dateFinished":"2018-05-15T11:45:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12731"},{"dateUpdated":"2018-05-15T09:20:56+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526376056950_1481993560","id":"20180308-161613_585284889","dateCreated":"2018-05-15T09:20:56+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:12732"}],"name":"Data Preparation","id":"2DE57B6BN","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}